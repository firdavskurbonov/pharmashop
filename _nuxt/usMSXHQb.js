import{E as Ct,G as It,g as B,r as x,z as L,c as l,H as Et,x as Nt,o as a,F as D,a as t,B as C,I as g,l as M,t as r,n as P,_ as St,J as Dt,w as ut,m as at,d as N,T as Tt,y as E,K as rt,L as Mt,b as T,p as Bt,v as Qt}from"./CvTZqFTh.js";import{u as z}from"./CVyImldQ.js";const At=Ct("products",{state:()=>({products:[],loading:!1,error:null,filters:{pageNumber:1,pageSize:5,manufacturer:null,priceRange:{min:null,max:null},sortBy:"default",searchQuery:"",categoryId:1},pagination:null}),getters:{filteredProducts:e=>e.products,manufacturers:e=>{const s=new Set(e.products.map(u=>u.ManufactName));return Array.from(s)},currentPage:e=>e.filters.pageNumber,pageSize:e=>e.filters.pageSize,totalPages:e=>{var s;return((s=e.pagination)==null?void 0:s.totalPages)||1}},actions:{async fetchProducts(e,s,u){this.loading=!0,this.error=null,e!==void 0&&(this.filters.searchQuery=e),s!==void 0&&(this.filters.pageNumber=s),u!==void 0&&(this.filters.pageSize=u);const c=this.buildApiUrl(),p=3;try{for(let h=0;h<p;h++)try{const{$axios:i}=It(),b=(await i.get(c,{timeout:3e4})).data;if(b.Success)this.products=b.Data,this.pagination={totalRecords:b.TotalRecords,pageSize:b.PageSize,currentPage:b.CurrentPage,totalPages:b.TotalPages,nextPageUrl:b.NextPageUrl,previousPageUrl:b.PreviousPageUrl};else throw new Error(b.Message||"Failed to fetch products");return}catch(i){if(h===p-1||!i.response)throw i;console.warn(`Attempt ${h+1} failed. Retrying...`)}}catch(h){const i=h;this.error=i.message||"Failed to fetch products",console.error("Error fetching products:",i)}finally{this.loading=!1}},buildApiUrl(){let e="/api/assortments?";return e+=`pageNumber=${this.filters.pageNumber}&pageSize=${this.filters.pageSize}`,this.filters.searchQuery&&(e+=`&ProductName=${encodeURIComponent(this.filters.searchQuery)}`),this.filters.categoryId!==null&&(e+=`&CategoryId=${this.filters.categoryId}`),this.filters.manufacturer&&(e+=`&Manufacturer=${encodeURIComponent(this.filters.manufacturer)}`),this.filters.priceRange.min!==null&&(e+=`&MinPrice=${this.filters.priceRange.min}`),this.filters.priceRange.max!==null&&(e+=`&MaxPrice=${this.filters.priceRange.max}`),this.filters.sortBy!=="default"&&(e+=`&SortBy=${encodeURIComponent(this.filters.sortBy)}`),e},setManufacturer(e){this.filters.manufacturer=e,this.filters.pageNumber=1,this.fetchProducts()},setPriceRange(e,s){this.filters.priceRange.min=e,this.filters.priceRange.max=s,this.filters.pageNumber=1,this.fetchProducts()},setSearchQuery(e){this.filters.searchQuery=e,this.filters.pageNumber=1},setSortBy(e){this.filters.sortBy=e,this.filters.pageNumber=1,this.fetchProducts()},setCategoryId(e){this.filters.categoryId=e,this.filters.pageNumber=1,this.fetchProducts()},setPageNumber(e){this.filters.pageNumber=e,this.fetchProducts()},setPageSize(e){this.filters.pageSize=e,this.filters.pageNumber=1,this.fetchProducts()},resetFilters(){this.filters={pageNumber:1,pageSize:5,manufacturer:null,priceRange:{min:null,max:null},sortBy:"default",searchQuery:"",categoryId:1}},goToNextPage(){this.pagination&&this.filters.pageNumber<this.pagination.totalPages&&(this.filters.pageNumber++,this.fetchProducts())},goToPreviousPage(){this.filters.pageNumber>1&&(this.filters.pageNumber--,this.fetchProducts())},goToPage(e){this.pagination&&e>=1&&e<=this.pagination.totalPages&&(this.filters.pageNumber=e,this.fetchProducts())}}}),Lt=Symbol.for("nuxt:client-only"),zt=B({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(e,{slots:s,attrs:u}){const c=x(!1);return L(()=>{c.value=!0}),Et(Lt,!0),p=>{var I;if(c.value)return(I=s.default)==null?void 0:I.call(s);const h=s.fallback||s.placeholder;if(h)return h();const i=p.fallback||p.placeholder||"",w=p.fallbackTag||p.placeholderTag||"span";return l(w,u,i)}}}),qt={key:0,class:"p-4 text-center text-gray-500"},Ft={key:1,class:"flex flex-col h-full"},Rt={class:"flex-grow overflow-y-auto p-4"},jt={class:"flex justify-between"},Ot={class:"flex-grow mr-2"},Ut={class:"font-medium"},Kt={class:"text-sm text-gray-500"},Wt={class:"flex justify-between items-center mt-2"},Ht={class:"flex items-center"},Vt=["onClick"],Jt={class:"bg-gray-100 px-4 py-1"},Gt=["onClick","disabled"],Xt={class:"font-medium"},Yt=["onClick"],Zt={class:"border-t p-4"},te={class:"flex justify-between mb-2"},ee={class:"flex justify-between font-bold text-lg mb-4"},se=B({__name:"ShoppingCart",props:{isOpen:{type:Boolean,required:!0}},emits:["close"],setup(e,{emit:s}){const u=s,c=z(),p=Nt(),h=y=>y==null?"0.00":y.toFixed(2),i=()=>{u("close")},w=y=>{c.removeItem(y)},I=y=>{c.incrementQuantity(y)},b=y=>{c.decrementQuantity(y)},Q=()=>{p.push({name:"checkout"})};return(y,m)=>(a(),l(D,null,[t("div",{class:P(["fixed top-0 right-0 h-full w-80 bg-white shadow-lg z-50 transform transition-transform duration-300",e.isOpen?"translate-x-0":"translate-x-full"])},[t("div",{class:"flex justify-between items-center p-4 border-b"},[m[2]||(m[2]=t("h2",{class:"text-lg font-semibold"},"Корзина",-1)),t("button",{onClick:i,class:"text-gray-500 hover:text-gray-700"},m[1]||(m[1]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),g(c).cartIsEmpty?(a(),l("div",qt,m[3]||(m[3]=[t("div",{class:"py-8"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mx-auto text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})]),t("p",{class:"mt-4"},"Ваша корзина пуста")],-1)]))):(a(),l("div",Ft,[t("div",Rt,[(a(!0),l(D,null,M(g(c).items,f=>(a(),l("div",{key:f.product.Id,class:"mb-4 border-b pb-4"},[t("div",jt,[t("div",Ot,[t("p",Ut,r(f.product.ProductName),1),t("p",Kt,r(h(f.product.Price))+" каждый ",1)])]),t("div",Wt,[t("div",Ht,[t("button",{onClick:v=>b(f.product.Id),class:"bg-gray-200 px-2 py-1 rounded-l"}," - ",8,Vt),t("span",Jt,r(f.quantity),1),t("button",{onClick:v=>I(f.product.Id),class:"bg-gray-200 px-2 py-1 rounded-r",disabled:f.quantity>=f.product.Quantity}," + ",8,Gt)]),t("div",null,[t("p",Xt,r(h(f.product.Price*f.quantity)),1),t("button",{onClick:v=>w(f.product.Id),class:"text-sm text-red-500 hover:text-red-700"}," Убрать ",8,Yt)])])]))),128))]),t("div",Zt,[t("div",te,[m[4]||(m[4]=t("span",null,"Всего препаратов:",-1)),t("span",null,r(g(c).totalItems),1)]),t("div",ee,[m[5]||(m[5]=t("span",null,"Итого:",-1)),t("span",null,r(h(g(c).totalPrice)),1)]),t("button",{onClick:Q,class:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded"}," Заказать "),t("button",{onClick:m[0]||(m[0]=(...f)=>g(c).clearCart&&g(c).clearCart(...f)),class:"w-full mt-2 bg-white hover:bg-gray-100 text-gray-800 font-medium py-2 px-4 border border-gray-400 rounded"}," Очистить корзину ")])]))],2),e.isOpen?(a(),l("div",{key:0,onClick:i,class:"fixed inset-0 bg-black bg-opacity-50 z-40"})):C("",!0)],64))}}),oe=z(),ne=B({name:"ProductInfo",props:{isOpen:{type:Boolean,default:!1},productId:{type:Object,required:!1}},data(){return{product:{},loading:!0,error:null,quantity:1,isInWishlist:!1,activeTab:"description",tabs:[{id:"description",label:"Описание"},{id:"additional",label:"Дополнительная информация"}]}},watch:{productId:{immediate:!0,handler(e){e&&this.isOpen&&this.fetchProductDetails()}},isOpen(e){e&&this.productId?(this.fetchProductDetails(),this.addKeyboardListeners()):this.removeKeyboardListeners(),e?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open")}},mounted(){this.isOpen&&this.addKeyboardListeners()},beforeUnmount(){this.removeKeyboardListeners(),document.body.classList.remove("modal-open")},methods:{addKeyboardListeners(){typeof document<"u"&&document.addEventListener("keydown",this.handleKeyDown)},removeKeyboardListeners(){typeof document<"u"&&document.removeEventListener("keydown",this.handleKeyDown)},handleKeyDown(e){e.key==="Escape"&&this.closeModal()},async fetchProductDetails(){if(this.productId){this.loading=!0,this.error=null;try{await new Promise(e=>setTimeout(e,300)),this.product={...this.productId},this.quantity=1,this.isInWishlist=this.checkIfInWishlist()}catch(e){console.error("Error fetching product details:",e),this.error="Failed to load product details. Please try again."}finally{this.loading=!1}}},closeModal(){this.$emit("close")},increaseQuantity(){this.quantity<this.product.Quantity&&this.quantity++},decreaseQuantity(){this.quantity>1&&this.quantity--},addToCart(){this.product.Quantity<=0||(oe.addItem({...this.product,Id:String(this.product.Id)},this.quantity),this.showToast(`${this.product.ProductName} добавлен в корзину!`,"success"))},toggleWishlist(){this.isInWishlist=!this.isInWishlist,this.isInWishlist?this.showToast(`${this.product.ProductName} добавлен в закладки!`,"success"):this.showToast(`${this.product.ProductName} удален из закладок.`,"info")},showToast(e,s="info"){this.$toast?this.$toast[s](e):console.log(`TOAST [${s}]: ${e}`)},checkIfInWishlist(){return!1},formatCurrency(e){return new Intl.NumberFormat("tg-TJ",{style:"currency",currency:"TJS",currencyDisplay:"name"}).format(e).replace("Tajikistani somonis","сомонӣ")},formatDate(e){const s={year:"numeric",month:"long",day:"numeric"};return new Date(e).toLocaleDateString("ru-RU",s)}}}),ie={key:0,class:"product-info-modal"},re={class:"modal-container"},ue={key:0,class:"modal-loading"},ae={key:1,class:"modal-error"},le={class:"modal-header"},de={class:"product-title"},ce={class:"modal-body"},pe={class:"product-info-grid"},fe={class:"product-gallery"},he={class:"main-image-container"},me=["alt"],ge={class:"product-details"},ye={class:"product-header"},ve={class:"product-meta"},be={class:"product-category"},xe={class:"product-price-container"},we={class:"current-price"},ke={class:"product-specs"},_e={class:"specs-list"},Pe={class:"spec-item"},$e={class:"spec-value"},Ce={class:"spec-item"},Ie={class:"spec-value"},Ee={class:"spec-item"},Ne={class:"spec-value"},Se={key:0},De={key:1},Te={key:0,class:"product-quantity"},Me={class:"quantity-selector"},Be=["disabled"],Qe={class:"quantity-display"},Ae=["disabled"],Le={class:"action-buttons"},ze=["disabled"],qe={class:"product-tabs"},Fe={class:"tabs-header"},Re=["onClick"],je={class:"tab-content"},Oe={key:0,class:"tab-pane"},Ue={class:"detailed-description"},Ke={key:1,class:"tab-pane"},We={class:"additional-info-table"};function He(e,s,u,c,p,h){return a(),Dt(Tt,{name:"modal-fade"},{default:ut(()=>[e.isOpen?(a(),l("div",ie,[t("div",{class:"modal-backdrop",onClick:s[0]||(s[0]=(...i)=>e.closeModal&&e.closeModal(...i))}),t("div",re,[t("div",{class:"modal-content",onClick:s[7]||(s[7]=at(()=>{},["stop"]))},[e.loading?(a(),l("div",ue,s[8]||(s[8]=[t("div",{class:"loader"},null,-1),t("p",null,"Загрузка информации о препарате...",-1)]))):e.error?(a(),l("div",ae,[t("p",null,r(e.error),1),t("button",{class:"retry-button",onClick:s[1]||(s[1]=(...i)=>e.fetchProductDetails&&e.fetchProductDetails(...i))}," Повторить попытку ")])):(a(),l(D,{key:2},[t("div",le,[t("h2",de,r(e.product.ProductName),1),t("button",{class:"close-button",onClick:s[2]||(s[2]=(...i)=>e.closeModal&&e.closeModal(...i)),"aria-label":"Close product details"},s[9]||(s[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)]))]),t("div",ce,[t("div",pe,[t("div",fe,[t("div",he,[t("img",{src:"https://placehold.co/400",alt:e.product.ProductName,class:"main-image"},null,8,me)])]),t("div",ge,[t("div",ye,[t("div",ve,[t("span",be,r(e.product.ManufactName),1)]),t("div",xe,[t("span",we,r(e.formatCurrency(e.product.Price)),1)])]),t("div",ke,[s[13]||(s[13]=t("h3",null,"Характеристики",-1)),t("ul",_e,[t("li",Pe,[s[10]||(s[10]=t("span",{class:"spec-label"},"Штрих-код:",-1)),t("span",$e,r(e.product.Barcode),1)]),t("li",Ce,[s[11]||(s[11]=t("span",{class:"spec-label"},"Срок годности:",-1)),t("span",Ie,r(e.formatDate(e.product.ExpireDate)),1)]),t("li",Ee,[s[12]||(s[12]=t("span",{class:"spec-label"},"Производитель:",-1)),t("span",Ne,r(e.product.ManufactName),1)])])]),t("div",{class:P(["product-availability",e.product.Quantity>0?"in-stock":"out-of-stock"])},[e.product.Quantity>0?(a(),l("span",Se,"В наличии ("+r(e.product.Quantity)+" шт.)",1)):(a(),l("span",De,"Нет в наличии"))],2),e.product.Quantity>0?(a(),l("div",Te,[s[16]||(s[16]=t("h3",null,"Количество",-1)),t("div",Me,[t("button",{class:"quantity-btn decrease",onClick:s[3]||(s[3]=(...i)=>e.decreaseQuantity&&e.decreaseQuantity(...i)),disabled:e.quantity<=1,"aria-label":"Decrease quantity"},s[14]||(s[14]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)]),8,Be),t("span",Qe,r(e.quantity),1),t("button",{class:"quantity-btn increase",onClick:s[4]||(s[4]=(...i)=>e.increaseQuantity&&e.increaseQuantity(...i)),disabled:e.quantity>=e.product.Quantity,"aria-label":"Increase quantity"},s[15]||(s[15]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)]),8,Ae)])])):C("",!0),t("div",Le,[t("button",{class:"add-to-cart-btn",onClick:s[5]||(s[5]=(...i)=>e.addToCart&&e.addToCart(...i)),disabled:e.product.Quantity<=0},s[17]||(s[17]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("circle",{cx:"9",cy:"21",r:"1"}),t("circle",{cx:"20",cy:"21",r:"1"}),t("path",{d:"M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"})],-1),N(" Добавить в корзину ")]),8,ze),t("button",{class:"wishlist-btn",onClick:s[6]||(s[6]=(...i)=>e.toggleWishlist&&e.toggleWishlist(...i))},[(a(),l("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:P({filled:e.isInWishlist})},s[18]||(s[18]=[t("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"},null,-1)]),2)),N(" "+r(e.isInWishlist?"Убрать из закладок":"Добавить в закладки"),1)])])])]),t("div",qe,[t("div",Fe,[(a(!0),l(D,null,M(e.tabs,i=>(a(),l("button",{key:i.id,class:P(["tab-button",{active:e.activeTab===i.id}]),onClick:w=>e.activeTab=i.id},r(i.label),11,Re))),128))]),t("div",je,[e.activeTab==="description"?(a(),l("div",Oe,[t("div",Ue,[s[19]||(s[19]=t("h4",null,"Информация о препарате",-1)),t("p",null,r(e.product.ProductName)+" - фармацевтический препарат от производителя "+r(e.product.ManufactName)+". ",1),t("p",null,"Штрих-код: "+r(e.product.Barcode),1),t("p",null," Срок годности до: "+r(e.formatDate(e.product.ExpireDate)),1)])])):C("",!0),e.activeTab==="additional"?(a(),l("div",Ke,[t("table",We,[t("tbody",null,[t("tr",null,[s[20]||(s[20]=t("th",null,"Идентификатор",-1)),t("td",null,r(e.product.Id),1)]),t("tr",null,[s[21]||(s[21]=t("th",null,"Наименование",-1)),t("td",null,r(e.product.ProductName),1)]),t("tr",null,[s[22]||(s[22]=t("th",null,"Штрих-код",-1)),t("td",null,r(e.product.Barcode),1)]),t("tr",null,[s[23]||(s[23]=t("th",null,"Количество в наличии",-1)),t("td",null,r(e.product.Quantity)+" шт.",1)]),t("tr",null,[s[24]||(s[24]=t("th",null,"Цена",-1)),t("td",null,r(e.formatCurrency(e.product.Price)),1)]),t("tr",null,[s[25]||(s[25]=t("th",null,"Срок годности",-1)),t("td",null,r(e.formatDate(e.product.ExpireDate)),1)]),t("tr",null,[s[26]||(s[26]=t("th",null,"Производитель",-1)),t("td",null,r(e.product.ManufactName),1)])])])])):C("",!0)])])])],64))])])])):C("",!0)]),_:1})}const Ve=St(ne,[["render",He],["__scopeId","data-v-553430f3"]]),Je={class:"container mx-auto px-4 py-8"},Ge={class:"cart-button-container"},Xe={key:0,class:"ml-2 bg-white text-indigo-600 rounded-full px-2 py-0.5 text-xs font-bold"},Ye={class:"mb-6"},Ze={class:"relative"},ts={key:0,class:"flex justify-center items-center h-64"},es={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6"},ss={class:"block sm:inline"},os={key:2,class:"text-center py-12"},ns={key:3,class:"bg-white shadow-md rounded-lg overflow-hidden"},is={class:"min-w-full divide-y divide-gray-200"},rs={class:"bg-white divide-y divide-gray-200"},us={class:"px-6 py-4 whitespace-normal"},as={class:"text-sm font-medium text-gray-900"},ls={class:"px-6 py-4 whitespace-nowrap"},ds={class:"text-sm text-gray-500"},cs={class:"px-6 py-4 whitespace-nowrap"},ps={class:"text-sm font-medium text-gray-900"},fs={class:"px-6 py-4 whitespace-nowrap"},hs={class:"px-6 py-4 whitespace-nowrap"},ms={class:"text-sm text-gray-500"},gs={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},ys={class:"flex justify-end space-x-2"},vs=["onClick"],bs=["onClick","disabled"],xs={key:0,class:"relative"},ws=["onClick"],ks={key:0,class:"absolute right-0 mt-2 p-2 bg-white rounded-md shadow-lg z-10 border quantity-popover"},_s={class:"flex items-center"},Ps=["onClick"],$s={class:"bg-gray-100 px-4 py-1"},Cs=["onClick","disabled"],Is=["onClick"],Es={class:"px-4 py-3 bg-gray-50 border-t border-gray-200 sm:px-6"},Ns={class:"flex items-center justify-between"},Ss={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},Ds={class:"text-sm text-gray-700"},Ts={class:"font-medium"},Ms={class:"font-medium"},Bs={class:"font-medium"},Qs={class:"flex-1 flex justify-between sm:justify-end"},As=["disabled"],Ls={class:"hidden md:flex mx-2"},zs=["onClick"],qs=["disabled"],Fs={__name:"ProductList",setup(e,{expose:s}){const u=At(),c=z(),p=x(1),h=x(5),i=x(""),w=x(""),I=x(null),b=x(null),Q=x("default"),y=x(!1),m=x(!1),f=x(null),v=x(null);L(async()=>{await _()});const lt=E(()=>u.loading),q=E(()=>u.error),F=E(()=>u.filteredProducts);E(()=>u.manufacturers);const R=E(()=>!u.pagination||u.pagination.totalRecords===0?0:(u.pagination.currentPage-1)*u.pagination.pageSize+1),dt=E(()=>u.pagination?Math.min(R.value+u.pagination.pageSize-1,u.pagination.totalRecords):0),ct=E(()=>{if(!u.pagination)return[];const o=u.pagination.totalPages,n=u.pagination.currentPage;return o<=7?Array.from({length:o},(k,S)=>S+1):n<=3?[1,2,3,4,5,"...",o]:n>=o-2?[1,"...",o-4,o-3,o-2,o-1,o]:[1,"...",n-1,n,n+1,"...",o]});async function _(){await u.fetchProducts(i.value,p.value,h.value)}function pt(o){typeof o=="number"&&(p.value=o,_())}function ft(){u.pagination&&p.value<u.pagination.totalPages&&(p.value++,_())}function ht(){p.value>1&&(p.value--,_())}function mt(){p.value=1,_(),u.setSearchQuery(i.value)}function gt(){i.value="",w.value="",I.value=null,b.value=null,Q.value="default",u.resetFilters(),p.value=1,_()}function yt(){_()}function vt(o){f.value=o,m.value=!0}function j(){m.value=!1,f.value=null}function bt(){y.value=!0}function O(){y.value=!1}function U(o){c.addItem(o,1)}function xt(o){return c.items.some(n=>n.id===o)}function A(o){const n=c.items.find(k=>k.id===o);return n?n.quantity:0}function wt(o){v.value===o?v.value=null:v.value=o}function kt(o){c.incrementItem(o)}function _t(o){c.decrementItem(o)}function Pt(o){c.removeItem(o),v.value=null}function K(o){return new Intl.NumberFormat("tg-TJ",{style:"currency",currency:"TJS",currencyDisplay:"name"}).format(o).replace("Tajikistani somonis","сомонӣ")}function W(o){return new Date(o).toLocaleDateString("ru-RU")}function $t(o){return o===0?"px-2 py-1 text-xs font-bold rounded-full bg-red-100 text-red-800":o<5?"px-2 py-1 text-xs font-bold rounded-full bg-yellow-100 text-yellow-800":"px-2 py-1 text-xs font-bold rounded-full bg-green-100 text-green-800"}function H(o){if(v.value!==null){const n=document.querySelectorAll(".quantity-popover");let k=!1;n.forEach(S=>{S.contains(o.target)&&(k=!0)}),k||(v.value=null)}}const V=o=>{o.key==="Escape"&&(v.value!==null&&(v.value=null),m.value&&j(),y.value&&O())},J=o=>{if(v.value!==null&&o.key==="Tab"){const n=document.querySelector(`[data-popover-id="${v.value}"]`);if(n){const k=n.querySelectorAll('button, [tabindex]:not([tabindex="-1"])');o.target===k[k.length-1]&&!o.shiftKey&&(v.value=null)}}};return rt(()=>u.pagination,o=>{o&&(h.value=o.pageSize,p.value=o.currentPage)},{deep:!0}),rt([i,w,p],()=>{const o=new URL(window.location);i.value?o.searchParams.set("search",i.value):o.searchParams.delete("search"),w.value?o.searchParams.set("manufacturer",w.value):o.searchParams.delete("manufacturer"),p.value>1?o.searchParams.set("page",p.value):o.searchParams.delete("page"),window.history.replaceState({},"",o)}),L(()=>{document.addEventListener("click",H),document.addEventListener("keydown",V),document.addEventListener("keydown",J);const o=new URLSearchParams(window.location.search);if(o.has("search")&&(i.value=o.get("search")),o.has("manufacturer")&&(w.value=o.get("manufacturer")),o.has("page")){const n=parseInt(o.get("page"));!isNaN(n)&&n>0&&(p.value=n)}_()}),Mt(()=>{document.removeEventListener("click",H),document.removeEventListener("keydown",V),document.removeEventListener("keydown",J)}),s({fetchProducts:_,resetFilters:gt,addToCart:U,formatPrice:K,formatDate:W}),(o,n)=>{var S,G,X,Y,Z,tt,et,st,ot,nt,it;const k=zt;return a(),l("div",Je,[t("div",Ge,[t("button",{onClick:bt,class:"cart-button bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded flex items-center"},[n[1]||(n[1]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})],-1)),n[2]||(n[2]=N(" Корзина ")),((S=g(c))==null?void 0:S.totalItems)!==void 0&&((G=g(c))==null?void 0:G.totalItems)>0?(a(),l("span",Xe,r(((X=g(c))==null?void 0:X.totalItems)||0),1)):C("",!0)])]),t("div",Ye,[t("div",Ze,[Bt(t("input",{"onUpdate:modelValue":n[0]||(n[0]=d=>i.value=d),onInput:mt,type:"text",placeholder:"Поиск препаратов...",class:"w-full px-4 py-2 pl-10 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,544),[[Qt,i.value]]),n[3]||(n[3]=t("div",{class:"absolute left-3 top-2.5 text-gray-400"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])]),lt.value?(a(),l("div",ts,n[4]||(n[4]=[t("div",{class:"text-center"},[t("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500 mx-auto"}),t("p",{class:"mt-4 text-gray-600"},"Загрузка препаратов...")],-1)]))):q.value?(a(),l("div",es,[n[5]||(n[5]=t("strong",{class:"font-bold"},"Error!",-1)),t("span",ss,r(q.value),1),t("button",{onClick:yt,class:"mt-2 bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-4 rounded"}," Попробуйте еще раз ")])):((Y=F.value)==null?void 0:Y.length)===0?(a(),l("div",os,n[6]||(n[6]=[t("h3",{class:"text-xl font-medium text-gray-900"},"Нет препаратов",-1),t("p",{class:"mt-4 text-gray-500"}," Попробуйте настроить фильтры или зайдите позже. ",-1)]))):(a(),l("div",ns,[t("table",is,[n[8]||(n[8]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Наименование "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Производитель "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Цена "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Количество "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Срок годности "),t("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Действия ")])],-1)),t("tbody",rs,[(a(!0),l(D,null,M(F.value,d=>(a(),l("tr",{key:d.Id,class:"hover:bg-gray-50"},[t("td",us,[t("div",as,r(d.ProductName),1)]),t("td",ls,[t("div",ds,r(d.ManufactName),1)]),t("td",cs,[t("div",ps,r(K(d.Price)),1)]),t("td",fs,[t("span",{class:P($t(d.Quantity))},r(d.Quantity),3)]),t("td",hs,[t("div",ms,r(W(d.ExpireDate)),1)]),t("td",gs,[t("div",ys,[t("button",{onClick:at($=>vt(d),["stop"]),class:"text-indigo-600 hover:text-indigo-900"},n[7]||(n[7]=[t("svg",{fill:"rgb(65 70 229)",width:"40px",height:"40px",viewBox:"-1 0 19 19",xmlns:"http://www.w3.org/2000/svg",class:"cf-icon-svg"},[t("path",{d:"M16.417 9.583A7.917 7.917 0 1 1 8.5 1.666a7.917 7.917 0 0 1 7.917 7.917zM5.85 3.309a6.833 6.833 0 1 0 2.65-.534 6.787 6.787 0 0 0-2.65.534zm2.654 1.336A1.136 1.136 0 1 1 7.37 5.78a1.136 1.136 0 0 1 1.135-1.136zm.792 9.223V8.665a.792.792 0 1 0-1.583 0v5.203a.792.792 0 0 0 1.583 0z"})],-1)]),8,vs),t("button",{onClick:$=>U(d),disabled:d.Quantity===0,class:P(["px-3 py-1 rounded-md text-sm",d.Quantity>0?"bg-indigo-600 hover:bg-indigo-700 text-white":"bg-gray-300 cursor-not-allowed text-gray-500"])}," Добавить ",10,bs),xt(d.Id)?(a(),l("div",xs,[t("button",{onClick:$=>wt(d.Id),class:"px-3 py-1 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-md text-sm"},r(A(d.Id))+" в корзине ",9,ws),v.value===d.Id?(a(),l("div",ks,[t("div",_s,[t("button",{onClick:$=>_t(d.Id),class:"bg-gray-200 px-2 py-1 rounded-l"}," - ",8,Ps),t("span",$s,r(A(d.Id)),1),t("button",{onClick:$=>kt(d.Id),class:"bg-gray-200 px-2 py-1 rounded-r",disabled:A(d.Id)>=d.Quantity}," + ",8,Cs)]),t("button",{onClick:$=>Pt(d.Id),class:"mt-2 w-full text-sm text-red-500 hover:text-red-700"}," Удалить из корзины ",8,Is)])):C("",!0)])):C("",!0)])])]))),128))])]),t("div",Es,[t("div",Ns,[t("div",Ss,[t("div",null,[t("p",Ds,[n[9]||(n[9]=N(" Показаны ")),t("span",Ts,r(R.value),1),n[10]||(n[10]=N(" - ")),t("span",Ms,r(dt.value),1),n[11]||(n[11]=N(" из ")),t("span",Bs,r(((Z=g(u).pagination)==null?void 0:Z.totalRecords)||0),1),n[12]||(n[12]=N(" товаров "))])])]),t("div",Qs,[t("button",{onClick:ht,disabled:((tt=g(u).pagination)==null?void 0:tt.currentPage)===1,class:P(["relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md bg-white",((et=g(u).pagination)==null?void 0:et.currentPage)===1?"text-gray-300 cursor-not-allowed":"text-gray-700 hover:bg-gray-50"])}," Предыдущая ",10,As),t("div",Ls,[(a(!0),l(D,null,M(ct.value,d=>{var $;return a(),l("button",{key:d,onClick:Rs=>pt(d),class:P(["relative inline-flex items-center px-4 py-2 border text-sm font-medium mx-1 rounded-md",d===(($=g(u).pagination)==null?void 0:$.currentPage)?"bg-indigo-600 text-white border-indigo-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"])},r(d),11,zs)}),128))]),t("button",{onClick:ft,disabled:((st=g(u).pagination)==null?void 0:st.currentPage)===((ot=g(u).pagination)==null?void 0:ot.totalPages),class:P(["relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md bg-white",((nt=g(u).pagination)==null?void 0:nt.currentPage)===((it=g(u).pagination)==null?void 0:it.totalPages)?"text-gray-300 cursor-not-allowed":"text-gray-700 hover:bg-gray-50"])}," Следующая ",10,qs)])])])])),T(se,{"is-open":y.value,onClose:O},null,8,["is-open"]),T(k,null,{default:ut(()=>[T(Ve,{isOpen:m.value,productId:f.value?{...f.value,Id:Number(f.value.Id)}:void 0,onClose:j},null,8,["isOpen","productId"])]),_:1})])}}},Us=B({__name:"products",setup(e){return(s,u)=>(a(),l("div",null,[t("main",null,[T(Fs)])]))}});export{Us as default};
