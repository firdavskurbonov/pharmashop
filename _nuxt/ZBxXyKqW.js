import{g as j,s as L,r as y,x as X,y as Y,z as Z,c as i,o as a,a as s,F as w,l as M,n as v,t as p,p as d,A as E,B as f,v as _,C as R,d as K,m as W,D as F,_ as J,b as D}from"./wuRFwLR8.js";import{u as ee}from"./uyDu4b4r.js";const se={class:"checkout-container"},te={class:"checkout-progress"},oe=["onClick"],ne={class:"step-number"},re={class:"step-label"},ie={class:"checkout-section"},ae={class:"form-row"},le={class:"form-group"},de={key:0,class:"error-message"},ue={class:"form-group"},ce={class:"form-row"},me={class:"form-group"},pe={key:0,class:"error-message"},ve={class:"form-group"},be={key:0,class:"error-message"},ye={class:"form-actions"},fe={class:"checkout-section"},he={class:"form-group"},_e={key:0,class:"error-message"},ke={class:"form-row"},ge={class:"form-group"},Ne={key:0,class:"error-message"},$e={class:"shipping-options"},Ce=["onClick"],xe={class:"option-radio"},Se=["id","value"],Te=["for"],Ve={class:"option-cost"},Le={class:"form-actions"},we={class:"checkout-section"},Me={class:"payment-methods"},Ee=["onClick"],Ue=["id","value"],Be=["for"],Ae=["src","alt"],Ie={class:"order-summary"},Oe={class:"summary-item"},qe={class:"summary-item"},Re={class:"summary-item"},Fe={class:"summary-item total"},je={key:0,id:"submit-error",class:"submit-error"},Je={class:"form-actions"},ze=["disabled"],Pe={key:0},Qe={key:1},Ge=3,He=j({__name:"Checkout",props:{isOpen:{type:Boolean,required:!0}},emits:["close","order-complete"],setup(z,{emit:U}){const k=ee(),n=L({firstName:"",lastName:"",email:"",phone:"",errors:{firstName:"",lastName:"",email:"",phone:""}}),r=L({addressLine1:"",city:"",errors:{addressLine1:"",city:""}}),g=y("cash"),P=L({phoneNumber:"",errors:{phoneNumber:""}}),B=()=>{let o=!0;return n.errors.firstName="",n.errors.phone="",n.firstName.trim()||(n.errors.firstName="–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ",o=!1),n.phone.trim()||(n.errors.phone="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω",o=!1),n.email&&!Q(n.email)&&(n.errors.email="–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email",o=!1),o},A=()=>{let o=!0;return r.errors.addressLine1="",r.errors.city="",r.addressLine1.trim()||(r.errors.addressLine1="–ê–¥—Ä–µ—Å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω",o=!1),r.city.trim()||(r.errors.city="–ì–æ—Ä–æ–¥ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω",o=!1),o},Q=o=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o),I=X(),$=y(!1),C=y(""),G=async()=>{const o=B(),e=A();if(!o||!e){const t=document.querySelector(".error-message");t&&t.scrollIntoView({behavior:"smooth",block:"center"});return}$.value=!0,C.value="";try{const t=q.value.find(b=>b.id===g.value),l=T.value.find(b=>b.id===h.value),m={orderNumber:`–ó–ê–ö–ê–ó-${Math.floor(1e5+Math.random()*9e5)}`,date:new Date().toLocaleString("ru-RU",{timeZone:"Asia/Dushanbe"}),status:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω",customer:{firstName:n.firstName,lastName:n.lastName,email:n.email,phone:n.phone},shippingAddress:{addressLine1:r.addressLine1,city:r.city},items:k.items.map(b=>({id:b.product.Id,name:b.product.ProductName,quantity:b.quantity,price:b.product.Price})),paymentMethod:(t==null?void 0:t.name)||"",paymentDetails:{phoneNumber:P.phoneNumber},shippingMethod:(l==null?void 0:l.name)||"",shippingCost:V.value,subtotal:x(),tax:S(),total:O()};localStorage.setItem("checkoutData",JSON.stringify(m)),await H(m),I.push({name:"orderconfirmation"}),k.clearCart()}catch(t){console.error("–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å:",t),C.value="–í–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –≤–∞—à–µ–≥–æ –∑–∞–∫–∞–∑–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.",F(()=>{const l=document.getElementById("submit-error");l&&l.scrollIntoView({behavior:"smooth",block:"center"})})}finally{$.value=!1}},u=y(1),N=o=>{if(o>u.value){if(u.value===1){if(!B())return}else if(u.value===2&&!A())return}u.value=o,F(()=>{const e=document.getElementById("checkout-form");e&&e.scrollIntoView({behavior:"smooth",block:"start"})})},x=()=>k.items.reduce((o,e)=>o+e.product.Price*e.quantity,0),S=()=>x()*.18,O=()=>x()+S()+V.value,T=y([{id:"standard",name:"–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ (1‚Äì2 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π)",cost:10},{id:"express",name:"–≠–∫—Å–ø—Ä–µ—Å—Å-–¥–æ—Å—Ç–∞–≤–∫–∞ (–≤ —Ç–µ—á–µ–Ω–∏–∏ –¥–Ω—è)",cost:20},{id:"immediate",name:"–°—Ä–æ—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ (—Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–∫–∞–∑–∞)",cost:50},{id:"pickup",name:"–°–∞–º–æ–≤—ã–≤–æ–∑",cost:0}]),q=y([{id:"cash",name:"–ù–∞–ª–∏—á–Ω—ã–º–∏",icon:null},{id:"ewallet",name:"–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –∫–æ—à–µ–ª–µ–∫(–î–°, –ê–ª–∏—Ñ, –≠—Å—Ö–∞—Ç–∞)",icon:null}]),h=y("standard"),V=Y(()=>{const o=T.value.find(e=>e.id===h.value);return o?o.cost:0}),c=o=>new Intl.NumberFormat("tg-TJ",{style:"currency",currency:"TJS",currencyDisplay:"name"}).format(o).replace("Tajikistani somonis","—Å–æ–º–æ–Ω”£"),H=async o=>{const e="7845700712:AAGupQg3jBQc9a_RgBprzLXUvQN-TaxA9MY",t="529229728",l=`
    üõí <b>–ù–æ–≤—ã–π –∑–∞–∫–∞–∑</b> üõí
    <b>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞:</b> ${o.orderNumber||"N/A"}
    <b>–î–∞—Ç–∞:</b> ${o.date||""}
    <b>–°—Ç–∞—Ç—É—Å:</b> ${o.status||"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω"}
    <b>–ö–ª–∏–µ–Ω—Ç:</b> ${o.customer.firstName||""} ${o.customer.lastName||""}
    <b>Email:</b> ${o.customer.email||"N/A"}
    <b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> ${o.customer.phone||"N/A"}
    <b>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</b> ${o.shippingAddress.addressLine1||""}, ${o.shippingAddress.city||""}
    <b>–ú–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã:</b> ${o.paymentMethod||"N/A"}
    <b>–ú–µ—Ç–æ–¥ –¥–æ—Å—Ç–∞–≤–∫–∏:</b> ${o.shippingMethod||"N/A"}
    <b>–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –∏—Ç–æ–≥:</b> ${c(o.subtotal||0)}
    <b>–î–æ—Å—Ç–∞–≤–∫–∞:</b> ${c(o.shippingCost||0)}
    <b>–ù–î–°:</b> ${c(o.tax||0)}
    <b>–ò—Ç–æ–≥–æ:</b> ${c(o.total||0)}
    <b>–¢–æ–≤–∞—Ä—ã:</b>
    ${o.items.map(m=>`- ${m.name} (x${m.quantity}): ${c(m.price*m.quantity)}`).join(`
`)}
    `;try{if(!(await fetch(`http://localhost:3005/api/telegram/bot${e}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:t,text:l,parse_mode:"HTML"})})).ok)throw new Error("Failed to send message to Telegram");console.log("Order sent to Telegram successfully!")}catch(m){console.error("Error sending order to Telegram:",m)}};return Z(()=>{k.items.length===0&&I.push({name:"products"})}),(o,e)=>(a(),i("div",se,[e[28]||(e[28]=s("h1",{class:"page-title"},"–ó–∞–∫–∞–∑",-1)),s("div",te,[(a(),i(w,null,M(Ge,t=>s("div",{key:t,class:v(["progress-step",{active:t<=u.value,completed:t<u.value}]),onClick:l=>t<u.value&&N(t)},[s("div",ne,p(t),1),s("div",re,p(t===1?"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ":t===2?"–î–æ—Å—Ç–∞–≤–∫–∞":"–û–ø–ª–∞—Ç–∞"),1)],10,oe)),64))]),s("form",{id:"checkout-form",onSubmit:W(G,["prevent"]),class:"checkout-form"},[d(s("div",ie,[e[17]||(e[17]=s("h2",null,"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ",-1)),s("div",ae,[s("div",le,[e[13]||(e[13]=s("label",{for:"firstName"},"–ò–º—è*",-1)),d(s("input",{id:"firstName","onUpdate:modelValue":e[0]||(e[0]=t=>n.firstName=t),type:"text",class:v({error:!n.firstName})},null,2),[[_,n.firstName]]),n!=null&&n.firstName?f("",!0):(a(),i("div",de," –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è "))]),s("div",ue,[e[14]||(e[14]=s("label",{for:"lastName"},"–§–∞–º–∏–ª–∏—è",-1)),d(s("input",{id:"lastName","onUpdate:modelValue":e[1]||(e[1]=t=>n.lastName=t),type:"text",class:v({error:!n.lastName})},null,2),[[_,n.lastName]])])]),s("div",ce,[s("div",me,[e[15]||(e[15]=s("label",{for:"email"},"Email",-1)),d(s("input",{id:"email","onUpdate:modelValue":e[2]||(e[2]=t=>n.email=t),type:"email",class:v({error:""})},null,512),[[_,n.email]]),n!=null&&n.email?f("",!0):(a(),i("div",pe))]),s("div",ve,[e[16]||(e[16]=s("label",{for:"phone"},"–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞*",-1)),d(s("input",{id:"phone","onUpdate:modelValue":e[3]||(e[3]=t=>n.phone=t),type:"tel",class:v({error:!n.phone})},null,2),[[_,n.phone]]),n!=null&&n.phone?f("",!0):(a(),i("div",be," –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ "))])]),s("div",ye,[s("button",{type:"button",class:"btn-secondary",onClick:e[4]||(e[4]=t=>o.$router.push("/products"))}," –ù–∞–∑–∞–¥ –∫ –ø–æ–∫—É–ø–∫–∞–º "),s("button",{type:"button",class:"btn-primary",onClick:e[5]||(e[5]=t=>N(2))}," –ü–µ—Ä–µ–π—Ç–∏ –∫ –¥–æ—Å—Ç–∞–≤–∫–µ ")])],512),[[E,u.value===1]]),d(s("div",fe,[e[21]||(e[21]=s("h2",null,"–î–æ—Å—Ç–∞–≤–∫–∞",-1)),s("div",he,[e[18]||(e[18]=s("label",{for:"addressLine1"},"–ê–¥—Ä–µ—Å*",-1)),d(s("input",{id:"addressLine1","onUpdate:modelValue":e[6]||(e[6]=t=>r.addressLine1=t),type:"text",class:v({error:!(r!=null&&r.addressLine1)})},null,2),[[_,r.addressLine1]]),r!=null&&r.addressLine1?f("",!0):(a(),i("div",_e," –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∞–¥—Ä–µ—Å "))]),s("div",ke,[s("div",ge,[e[19]||(e[19]=s("label",{for:"city"},"–ì–æ—Ä–æ–¥*",-1)),d(s("input",{id:"city","onUpdate:modelValue":e[7]||(e[7]=t=>r.city=t),type:"text",class:v({error:!(r!=null&&r.city)})},null,2),[[_,r.city]]),r!=null&&r.city?f("",!0):(a(),i("div",Ne," –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≥–æ—Ä–æ–¥ "))])]),s("div",$e,[e[20]||(e[20]=s("h3",null,"–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏",-1)),(a(!0),i(w,null,M(T.value,t=>(a(),i("div",{key:t.id,class:v(["shipping-option",{selected:h.value===t.id}]),onClick:l=>h.value=t.id},[s("div",xe,[d(s("input",{type:"radio",id:t.id,value:t.id,"onUpdate:modelValue":e[8]||(e[8]=l=>h.value=l)},null,8,Se),[[R,h.value]]),s("label",{for:t.id},p(t.name),9,Te)]),s("div",Ve,p(c(t.cost)),1)],10,Ce))),128))]),s("div",Le,[s("button",{type:"button",class:"btn-secondary",onClick:e[9]||(e[9]=t=>N(1))}," –ù–∞–∑–∞–¥ –∫ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∏–µ–Ω—Ç–µ "),s("button",{type:"button",class:"btn-primary",onClick:e[10]||(e[10]=t=>N(3))}," –ü–µ—Ä–µ–π—Ç–∏ –∫ –û–ø–ª–∞—Ç–µ ")])],512),[[E,u.value===2]]),d(s("div",we,[e[27]||(e[27]=s("h2",null,"–ú–µ—Ç–æ–¥—ã –æ–ø–ª–∞—Ç—ã",-1)),s("div",Me,[(a(!0),i(w,null,M(q.value,t=>(a(),i("div",{key:t.id,class:v(["payment-method",{selected:g.value===t.id}]),onClick:l=>g.value=t.id},[d(s("input",{type:"radio",id:t.id,value:t.id,"onUpdate:modelValue":e[11]||(e[11]=l=>g.value=l)},null,8,Ue),[[R,g.value]]),s("label",{for:t.id},[t.icon?(a(),i("img",{key:0,src:t.icon,alt:t.name},null,8,Ae)):f("",!0),K(" "+p(t.name),1)],8,Be)],10,Ee))),128))]),s("div",Ie,[e[26]||(e[26]=s("h3",null,"–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞",-1)),s("div",Oe,[e[22]||(e[22]=s("span",null,"–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –∏—Ç–æ–≥",-1)),s("span",null,p(c(x())),1)]),s("div",qe,[e[23]||(e[23]=s("span",null,"–î–æ—Å—Ç–∞–≤–∫–∞",-1)),s("span",null,p(c(V.value)),1)]),s("div",Re,[e[24]||(e[24]=s("span",null,"–ù–î–°",-1)),s("span",null,p(c(S())),1)]),s("div",Fe,[e[25]||(e[25]=s("span",null,"–ò—Ç–æ–≥–æ",-1)),s("span",null,p(c(O())),1)])]),C.value?(a(),i("div",je,p(C.value),1)):f("",!0),s("div",Je,[s("button",{type:"button",class:"btn-secondary",onClick:e[12]||(e[12]=t=>N(2))}," –ù–∞–∑–∞–¥ –∫ –î–æ—Å—Ç–∞–≤–∫–µ "),s("button",{type:"submit",class:"btn-primary btn-place-order",disabled:$.value},[$.value?(a(),i("span",Pe,"–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è...")):(a(),i("span",Qe,"–ó–∞–∫–∞–∑–∞—Ç—å"))],8,ze)])],512),[[E,u.value===3]])],32)]))}}),Xe=J(He,[["__scopeId","data-v-490e2993"]]),Ye=j({__name:"checkout",setup(z){const U=()=>{console.log("Checkout closed")};return(k,n)=>(a(),i("div",null,[D(Xe,{isOpen:!0,onClose:U})]))}}),We=J(Ye,[["__scopeId","data-v-d3a5938b"]]);export{We as default};
